<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  <title>Architecture | Theseus Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="This post will describe how theseus works, it’s usefull for developers and who want to contribute. Table of Contents Theseus Topological Graph The Proxy The Auth The Api K8S Api Map Volume Management">
<meta name="keywords">
<meta property="og:type" content="article">
<meta property="og:title" content="Architecture">
<meta property="og:url" content="http://blog.theseus.online/2017/04/27/architecture/index.html">
<meta property="og:site_name" content="Theseus Blog">
<meta property="og:description" content="This post will describe how theseus works, it’s usefull for developers and who want to contribute. Table of Contents Theseus Topological Graph The Proxy The Auth The Api K8S Api Map Volume Management">
<meta property="og:updated_time" content="2017-05-10T08:14:43.114Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Architecture">
<meta name="twitter:description" content="This post will describe how theseus works, it’s usefull for developers and who want to contribute. Table of Contents Theseus Topological Graph The Proxy The Auth The Api K8S Api Map Volume Management">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/typing.css">
</head>

  
    
      <body>
    
  
      <div id="container" class="container">
        <article id="post-architecture" class="article article-type-post" itemscope itemprop="blogPost">
  <header id="header" class="header">
  <nav id="main-nav" class="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="https://theseus.online/#/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    
  </nav>
</header>

  <hr/>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Architecture
    </h1>
  

      </header>
    
    <div class="article-entry typo" itemprop="articleBody">
      
        <p>This post will describe how theseus works, it’s usefull for developers and who want to contribute.</p>
<h3 id="Table-of-Contents"><a href="#Table-of-Contents" class="headerlink" title="Table of Contents"></a>Table of Contents</h3><ul>
<li><a href="#Theseus-Topological-Graph">Theseus Topological Graph</a><ul>
<li><a href="#The-Proxy">The Proxy</a></li>
<li><a href="#The-Auth">The Auth</a></li>
<li><a href="#The-Api">The Api</a><ul>
<li><a href="#K8S-Api-Map">K8S Api Map</a></li>
<li><a href="#Volume-Management">Volume Management</a></li>
</ul>
</li>
<li><a href="#The-Portal">The Portal</a></li>
</ul>
</li>
</ul>
<h3 id="Theseus-Topological-Graph"><a href="#Theseus-Topological-Graph" class="headerlink" title="Theseus Topological Graph"></a>Theseus Topological Graph</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">                                                      -----------</div><div class="line">                                                ----&gt; | k8s api |</div><div class="line">                                                |     -----------</div><div class="line">                                    --------    |</div><div class="line">                              ----&gt; |  api | ---|</div><div class="line">                              |     --------    |</div><div class="line">-----------      ---------    |     ----------  |     -------------    ------------</div><div class="line">| browser | ---&gt; | proxy | ---|---&gt; | portal |  |---&gt; | postgrest | -&gt; | postgres |</div><div class="line">-----------      ---------    |     ----------  |     -------------    ------------</div><div class="line">                              |     --------    |</div><div class="line">                              ----&gt; | auth | ---|</div><div class="line">                                    --------    |</div><div class="line">                                                |     --------------</div><div class="line">                                                ----&gt; | github api |</div><div class="line">                                                      --------------</div></pre></td></tr></table></figure>
<h4 id="The-Proxy"><a href="#The-Proxy" class="headerlink" title="The Proxy"></a>The Proxy</h4><p>The proxy is a reverse proxy, it has two missions:</p>
<ul>
<li>proxy request to appropriate backend by different url.</li>
<li>check if a request has validate cookie(signature) if it’s dest backend is <code>api</code>.</li>
</ul>
<h4 id="The-Auth"><a href="#The-Auth" class="headerlink" title="The Auth"></a>The Auth</h4><p>The auth module’s work is simple:</p>
<ul>
<li>when user request for login, it redirect user to github oauth page.</li>
<li>when github redirect user back to callback url, it request github for user information, then it set cookie with user information and signature it. Besides， it should update user information to database(aka postgres).</li>
<li>when user request for logout, it erase cookie.</li>
</ul>
<h4 id="The-Api"><a href="#The-Api" class="headerlink" title="The Api"></a>The Api</h4><p>The api’s work contains two aspects:</p>
<ul>
<li>Map user request to k8s format, and proxy it to k8s api.</li>
<li>Manage persistant volumes.</li>
</ul>
<h5 id="K8S-Api-Map"><a href="#K8S-Api-Map" class="headerlink" title="K8S Api Map"></a>K8S Api Map</h5><p>Theseus api will map and proxy deployment, service and ingress request to k8s, so that the frontend don’t need know if the backend is k8s or not.</p>
<h5 id="Volume-Management"><a href="#Volume-Management" class="headerlink" title="Volume Management"></a>Volume Management</h5><p>User can mount two kinds of volumes to container: persistant volume and <code>Empty Directory</code> volume. The difference between them is that the persistant volume is always exists unless user delete them manually, but the <code>Empty Directory</code> volume never live longer than the deployment it attached to, in other words, when you create or update deployment, there is no way to choise a <code>Empty Directory</code> volume created before.<br>Here is a compare between <code>Empty Directory</code> volume and persistant volume:</p>
<table>
<thead>
<tr>
<th>volume</th>
<th>persistant volume</th>
<th>Empty Directory volume</th>
</tr>
</thead>
<tbody>
<tr>
<td>life</td>
<td>forever</td>
<td>in the deployment</td>
</tr>
<tr>
<td>name</td>
<td>can named by user</td>
<td>empty-dir-*</td>
</tr>
<tr>
<td>backend</td>
<td>NFS</td>
<td>host local storage</td>
</tr>
<tr>
<td>speed</td>
<td>slow</td>
<td>fast</td>
</tr>
</tbody>
</table>
<h4 id="The-Portal"><a href="#The-Portal" class="headerlink" title="The Portal"></a>The Portal</h4><p>The portal is the user interface, served as static files(html, js, css etc.).</p>

      
    </div>
    <footer class="article-footer">
      <ul class="article-meta">
        <li>
          <span class="label">Published Date:</span>
          <a href="/2017/04/27/architecture/" class="article-date">
  <time datetime="2017-04-26T16:00:00.000Z" itemprop="datePublished">2017-04-27</time>
</a>

        </li>
        
        
        <hr/>
      </ul>
    </footer>
  </div>
  
    
<nav id="article-nav" class="article-nav">
  
    <a href="/2017/04/21/getting-start/" id="article-nav-newer" class="article-nav-link-wrap newer">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Getting Start
        
      </div>
    </a>
  
  
    <a href="/2017/05/10/original-intention/" id="article-nav-older" class="article-nav-link-wrap older">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Original Intention</div>
    </a>
  
</nav>


  
</article>




      </div>
      
    <footer id="footer" class="post-footer footer">
      <hr/>
      <div id="footerContent" class="footer-content">
        

      </div>
    </footer>

      

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/typing.js"></script>
<!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->







    </div>
  </body>
</html>
